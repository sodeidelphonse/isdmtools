% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spatialFoldDiagnostics.R
\name{check_env_balance}
\alias{check_env_balance}
\alias{check_env_balance.DataFolds}
\title{Check Environmental Balance of Folds}
\usage{
check_env_balance(object, ...)

\method{check_env_balance}{DataFolds}(
  object,
  covariates,
  plot_type = c("density", "boxplot"),
  n_background = 10000,
  ...
)
}
\arguments{
\item{object}{A \code{DataFolds} object.}

\item{...}{Additional arguments passed to \code{sample_background}.}

\item{covariates}{A \code{SpatRaster} (terra) containing environmental layers.
It must have the same coordinate reference system (CRS) as the sf objects used for blocking.}

\item{plot_type}{Character. Either "density" (default) or "boxplot".}

\item{n_background}{Numeric. Number of background points to sample for environmental
space representation. Default 10,000.}
}
\value{
An object of class \code{EnvDiagnostic}.
}
\description{
Evaluates whether environmental covariates are well-balanced
across folds. It extracts values from a \code{SpatRaster} at point locations.
For large rasters, it uses a background sample to represent the study area.
}
\details{
The function also calculates the environmental niche overlap using Schoener's D
metric (Schoener, 1968). This metric ranges from 0 (no overlap) to 1 (identical
niches).
\itemize{
\item \strong{Schoener's D}: Quantifies how well each fold represents the
available environmental space (the background). A median value is reported
across all folds for each covariate.
\item \strong{Interpretation}: Values > 0.6 generally indicate that the folds
are representative of the study area's environmental conditions. Low values
suggest that cross-validation results may be biased because the model is being
tested on environmental conditions it rarely encountered during training.
}
}
\examples{
\dontrun{
# 'datasets' is a list of sf objects (e.g. presence-only and presence-absence)
datasets_list <- list(Presence = presence_data, Count = count_data)

# Create Folds
folds_obj <- create_folds(
  datasets = my_data_list,
  region_polygon = ben_utm,
  k = 5,
  seed = 23,
  cv_method = "cluster"
)

# Check Environmental Representation
env_diag <- check_env_balance(
  object = folds_obj,
  covariates = c("temp", "precip", "elevation"),
  plot_type = "density"
)

# View p-values in console
print(env_diag)

# View density plots
plot(env_diag)


#--- Mixture of continuous and categorical covariates
r_temp <- terra::rast(extent = c(0, 10, 0, 10), res = 1, val = runif(100, 15, 25))
r_land <- terra::rast(extent = c(0, 10, 0, 10), res = 1, val = sample(1:3, 100, TRUE))

# Set up land cover as a factor
levels(r_land) <- data.frame(ID = 1:3, cover = c("Forest", "Grass", "Urban"))
env_stack <- c(r_temp, r_land)
names(env_stack) <- c("temperature", "land_use")

# Run the diagnostic with 500 cells for a quick example
env_diag <- check_env_balance(
  object = folds_obj,
  covariates = env_stack,
  n_background = 500,
  plot_type = "boxplot"
)

# Inspect results
# 'temperature' will show a p-value and Schoener's D
# 'land_use' will show a p-value (Chi-sq) and Schoener_D as NA
print(env_diag)

# The plot will automatically facet both types
plot(env_diag)
}

}
\seealso{
Other blocks diagnostics: 
\code{\link{check_folds}()},
\code{\link{print.EnvDiagnostic}()},
\code{\link{print.FoldsSummary}()},
\code{\link{print.GeoDiagnostic}()},
\code{\link{summarise_fold_diagnostics}()}
}
\concept{blocks diagnostics}
