% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Suitability.R
\name{suitability_index}
\alias{suitability_index}
\title{Compute a unified suitability index from integrated spatial model predictions.}
\usage{
suitability_index(
  x,
  post_stat = "mean",
  output_format = c("prob", "response", "linear"),
  response_type = c("joint.po", "count.pa", "po", "count", "pa"),
  has_offset = FALSE,
  scale_independent = FALSE,
  projection = NULL,
  ...
)
}
\arguments{
\item{x}{A \code{data.frame} containing \code{x} and \code{y} coordinates and the column(s) of the predicted linear predictor variables (e.g., mean, standard deviation and quantiles) or \code{SpatRaster}.
It can typically be a standardized grid-based output from a \link{prepare_predictions} call to various classes of spatial prediction on a linear scale, e.g. from the \code{PointedSDMs} or \code{inlabru} packages.}

\item{post_stat}{character. A vector specifying the column or layer name(s) to use for extracting the model predictions. Defaults to "mean".}

\item{output_format}{character. The desired output format and must be one of "prob" (probability-based suitability index), "response" (expected count or rate) or "linear" (linear predictor scale).}

\item{response_type}{character. The type of response data the model was fitted with.
Must be one of "joint.po" (joint model including presence-only data), "count.pa" (joint model with count and presence-absence), "po" (single presence-only model), "count" (count model), or "pa" (presence-absence model).}

\item{has_offset}{logical. For \code{count.pa}, \code{count} and \code{pa} models, this should be \code{TRUE} if the linear predictor includes an explicit area offset.
This argument is not used for "po" or "joint.po" models. Defaults to \code{FALSE}.}

\item{scale_independent}{logical. If \code{TRUE}, the scaling factor is set to 1, making the suitability index independent of the grid cell size. Defaults to \code{FALSE}.}

\item{projection}{character. The coordinate reference system (CRS) for the output raster. Defaults to \code{NULL}.
If \code{NULL} and \code{x} is a data.frame, an empty CRS is assigned to prevent errors.}

\item{...}{Additional arguments passed to \link[terra]{rast}.}
}
\value{
A SpatRaster object representing the requested output format.
}
\description{
This function converts the linear predictor (\code{eta}) from a fitted integrated spatial model
into a unified suitability index, which can be interpreted as a probability of a species presence.
It also calculates the intensity(rate) or expected count for the count data, depending on whether the model has offset or not.
}
\details{
This function implements a unified framework for converting model predictions to a
comparable suitability index. The method relies on the \emph{Inhomogeneous Poisson Process (IPP)}
theory, where the linear predictor \code{eta} is related to the probability of presence
via the inverse complementary log-log link as follows: \eqn{p(presence) = 1 - exp(-scaling \times exp(eta))}.

The \code{scaling} factor is determined by the \code{response_type} and the \code{has_offset} arguments:
\itemize{
\item For PO models (single or part of a joint model), \code{eta} is always a log-rate, and the \code{scaling} is set to the cell area.
It is ignored if \code{scale_independent} is set to TRUE.
\item For Count or PA models, if \code{has_offset = TRUE}, \code{eta} is a log-rate, and \code{scaling} is the cell area.
\item In all other cases (\code{has_offset = FALSE}), \code{eta} is treated as a log of the expected count (count) or cloglog of probability (PA), and \code{scaling} is set to \code{1}.
}
If the raster is in a geographic coordinate system (longlat), the area is calculated in \eqn{km^2} using \link[terra]{cellSize}.
For projected systems, the area is the product of the resolutions (e.g., \eqn{km^2} if units are in km).
}
\examples{
\dontrun{
library(terra)
# Simulate a sample data.frame with x, y, and a linear predictor
set.seed(42)
x <- expand.grid(x = seq(0, 50, 1), y = seq(0, 50, 1))
x$eta <- rnorm(nrow(x), mean = 0, sd = 1)

# Create a simple raster object
x_rast <- rast(x)

# Generate a suitability index for a Presence-Absence model
pa_probability <- suitability_index(
  x_rast,
  post_stat = "eta",
  response_type = "pa"
)
plot(pa_probability)

# Create a binary map using a fixed threshold
binary_map <- app(pa_probability, function(x) ifelse(x < 0.5, 0, 1))
plot(binary_map)

# Generate an expected mean (assume "eta" is from a count model)
count_expected_mean <- suitability_index(
  x_rast,
  post_stat = "eta",
  response_type = "count",
  output_format = "response"
)
plot(count_expected_mean)
}

}
\references{
Dorazio RM. Accounting for imperfect detection and survey bias in statistical analysis of presence-only data. \emph{Global Ecology and Biogeography} (2014) 23:1472–1484. \doi{10.1111/geb.12216}

Fithian W, Elith J, Hastie T, Keith DA. Bias correction in species distribution models: pooling survey and collection data for multiple species. \emph{Methods in Ecology and Evolution} (2015) 6:424–438. \doi{10.1111/2041-210X.12242}

Phillips SJ, Anderson RP, Dudík M, et al Opening the black box: an open‐source release of Maxent. \emph{Ecography} (2017) 40:887–893. \doi{10.1111/ecog.03049}
}
\seealso{
Other prediction analyses: 
\code{\link{generate_maps}()},
\code{\link{prepare_predictions}()}
}
\concept{prediction analyses}
