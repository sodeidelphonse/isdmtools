% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spatialFoldDiagnostics.R
\name{check_folds}
\alias{check_folds}
\alias{check_folds.DataFolds}
\title{Check Spatial Folds Independence}
\usage{
check_folds(object, ...)

\method{check_folds}{DataFolds}(object, rho = NULL, plot = TRUE, ...)
}
\arguments{
\item{object}{A \code{DataFolds} object created by \code{create_folds()}.}

\item{...}{Additional arguments.}

\item{rho}{Numeric. Optional. The practical range (km) estimated from the exploratory
analysis or the posterior practical range from a Bayesian analysis.
the one estimated from the integrated model (e.g., the Matérn range parameter).}

\item{plot}{Logical. If \code{TRUE}, returns a diagnostic plot.}
}
\value{
An object of class \code{GeoDiagnostic}.
}
\description{
Evaluates the geometric properties of spatial folds to ensure spatial independence
for cross-validation. This function verifies if block sizes and inter-block gaps
are sufficient relative to the prior or model's estimated spatial range (\eqn{\rho}).
}
\details{
The function assesses independence based on the minimum gap between folds
compared to the practical range (\eqn{\rho}):
\itemize{
\item \strong{Contiguous}: Gap = 0. High risk of spatial leakage; observations in
test folds are spatially correlated with training data.
\item \strong{Weakly Independent}: 0 < Gap < \eqn{\rho}. A physical gap exists,
but correlation remains above 0.1.
\item \strong{Independent}: Gap \eqn{\ge \rho}. Spatial correlation is below 0.1
at the boundary; satisfying standard requirements for spatial independence
for most blocked cross-validation applications (Roberts et al. 2017).
}

The spatial range can be estimated using the function \code{\link[blockCV]{cv_spatial_autocor}} of
the \pkg{blockCV} package (Valavi et al. 2018) or any other tool. The authors recommended this value (in metres)
as the optimal block size for their spatial blocking scheme. For instance, if a covariance model is fitted
to the experimental variogram, the 10\% practical range can be derived using an interpolation method.
Note that several packages are available to estimate the range from the observed spatial data and
different parameterisations are used. We provide the helper function \code{\link{solve_practical_range}} to allow to
derive a unified practical range for Matérn covariance fitted to the data in INLA, geoR or spatstat packages.
}
\examples{
\dontrun{
library(sf)
library(terra)
library(ggplot2)
library(isdmtools)

# Generate the data as a list of sf objects
set.seed(42)
presence_data <- data.frame(
 x = runif(100, 0, 4),
 y = runif(100, 6, 13),
 site = rbinom(100, 1, 0.6)
) \%>\% st_as_sf(coords = c("x", "y"), crs = 4326)

count_data <- data.frame(
  x = runif(50, 0, 4),
 y = runif(50, 6, 13),
 count = rpois(50, 5)
) \%>\% st_as_sf(coords = c("x", "y"), crs = 4326)

datasets_list <- list(Presence = presence_data, Count = count_data)

ben_coords <- matrix(c(0, 6, 4, 6, 4, 13, 0, 13, 0, 6), ncol = 2, byrow = TRUE)
ben_sf <- st_sfc(st_polygon(list(ben_coords)), crs = 4326)
ben_sf <- st_sf(data.frame(name = "Benin"), ben_sf)

# Create Folds using create_folds()
folds <- create_folds(
  datasets_list,
  region_polygon = ben_sf,
  k = 5,
  cv_method = "cluster"
)

# Check Spatial Independence
# Assuming the autocorrelation practical range (rho) is 150 km
spat_diag <- check_folds(folds, rho = 150, plot = TRUE)

# View results
print(spat_diag)
plot(spat_diag)
}
}
\references{
\itemize{
\item Roberts DR, Bahn V, Ciuti S, Boyce MS, Elith J, Guillera-Arroita G, Hauenstein S, Lahoz-Monfort JJ, Schröder B, Thuiller W, et al. Cross-validation strategies for data with temporal, spatial, hierarchical, or phylogenetic structure. \emph{Ecography} (2017) 40:913–929. \doi{10.1111/ecog.02881}.
\item Valavi R, Elith J, Lahoz-Monfort JJ, Guillera-Arroita G. blockCV: an R package for generating spatially or environmentally separated folds for k-fold cross-validation of species distribution models. \emph{bioRxiv} (2018). \doi{10.1101/357798}.
}
}
\seealso{
\code{\link{DataFolds-methods}} for interacting with \code{DataFolds} objects.

Other diagnostic tools: 
\code{\link{EnvDiagnostic-methods}},
\code{\link{GeoDiagnostic-methods}},
\code{\link{check_env_balance}()},
\code{\link{summarise_fold_diagnostics}()}
}
\concept{diagnostic tools}
